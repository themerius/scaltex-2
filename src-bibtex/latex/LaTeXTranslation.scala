package io.bibimbap
package latex

trait LaTeXTranslation {
  self : LaTeXElements =>

  def translate(macroName : String, args : Seq[Group]) : Option[String] = {
    val argc = args.size

    val foundSoFar = if(argc == 0) {
      nullary.get(macroName)
    } else if(argc == 1) {
      args(0).elems match {
        case Seq() => nullary.get(macroName)
        case Seq(RawString(v)) => unary.get((macroName, v))
        case _ => None
      }
    } else if(argc == 2) {
      (args(0).elems, args(1).elems) match {
        case (Seq(RawString(v1)), Seq(RawString(v2))) => binary.get((macroName, v1, v2))
        case _ => None
      }
    } else {
      None
    }
    
    foundSoFar.orElse {
      defs.get(macroName, argc).flatMap(f => f(args))
    }
  }

  private val nullary : Map[String,String] = Map(
    "LaTeX"      -> "LaTeX",
    "TeX"        -> "TeX",
    " "          -> " ",
    "'a"         -> "Ã¡",
    "'A"         -> "Ã",
    "'e"         -> "Ã©",
    "'E"         -> "Ã‰",
    "'i"         -> "Ã­", // this is technically speaking incorrect
    "'I"         -> "Ã",
    "'o"         -> "Ã³",
    "'O"         -> "Ã“",
    "'u"         -> "Ãº",
    "'U"         -> "Ãš",
    "'y"         -> "Ã½",
    "'Y"         -> "Ã",
    "`a"         -> "Ã ",
    "`A"         -> "Ã€",
    "`e"         -> "Ã¨",
    "`E"         -> "Ãˆ",
    "`i"         -> "Ã¬", // see above
    "`I"         -> "ÃŒ",
    "`o"         -> "Ã²",
    "`O"         -> "Ã’",
    "`u"         -> "Ã¹",
    "`U"         -> "Ã™",
    "`y"         -> "á»³",
    "`Y"         -> "á»²",
    "^a"         -> "Ã¢",
    "^A"         -> "Ã‚",
    "^e"         -> "Ãª",
    "^E"         -> "ÃŠ",
    "^i"         -> "Ã®", // see above
    "^I"         -> "ÃŽ",
    "^o"         -> "Ã´",
    "^O"         -> "Ã”",
    "^u"         -> "Ã»",
    "^U"         -> "Ã›",
    "^y"         -> "Å·",
    "^Y"         -> "Å¶",
    "\"a"        -> "Ã¤",
    "\"A"        -> "Ã„",
    "\"e"        -> "Ã«",
    "\"E"        -> "Ã‹",
    "\"i"        -> "Ã¯", // see above
    "\"I"        -> "Ã",
    "\"o"        -> "Ã¶",
    "\"O"        -> "Ã–",
    "\"u"        -> "Ã¼",
    "\"U"        -> "Ãœ",
    "\"y"        -> "Ã¿",
    "\"Y"        -> "Å¸",
    "~a"         -> "Ã£",
    "~A"         -> "Ãƒ",
    "~n"         -> "Ã±",
    "~N"         -> "Ã‘",
    "ae"         -> "Ã¦",
    "AE"         -> "Ã†",
    "aa"         -> "Ã¥",
    "AA"         -> "Ã…",
    "oe"         -> "Å“",
    "OE"         -> "Å’",
    "o"          -> "Ã¸",
    "O"          -> "Ã˜",
    "ss"         -> "ÃŸ",
    "i"          -> "i"
  ) ++ UnicodeSymbols.macroToSymbol

  private val unary : Map[(String,String),String] = Map(
    ("c", "c") -> "Ã§",
    ("c", "C") -> "Ã‡",
    ("'", "a") -> "Ã¡",
    ("'", "A") -> "Ã",
    ("'", "e") -> "Ã©",
    ("'", "E") -> "Ã‰",
    ("'", "i") -> "Ã­",
    ("'", "I") -> "Ã",
    ("'", "o") -> "Ã³",
    ("'", "O") -> "Ã“",
    ("'", "u") -> "Ãº",
    ("'", "U") -> "Ãš",
    ("'", "y") -> "Ã½",
    ("'", "Y") -> "Ã",
    ("'", "c") -> "Ä‡",
    ("'", "C") -> "Ä†",
    ("`", "a") -> "Ã ",
    ("`", "A") -> "Ã€",
    ("`", "e") -> "Ã¨",
    ("`", "E") -> "Ãˆ",
    ("`", "i") -> "Ã¬",
    ("`", "I") -> "ÃŒ",
    ("`", "o") -> "Ã²",
    ("`", "O") -> "Ã’",
    ("`", "u") -> "Ã¹",
    ("`", "U") -> "Ã™",
    ("`", "y") -> "á»³",
    ("`", "Y") -> "á»²",
    ("^", "a") -> "Ã¢",
    ("^", "A") -> "Ã‚",
    ("^", "e") -> "Ãª",
    ("^", "E") -> "ÃŠ",
    ("^", "i") -> "Ã®",
    ("^", "I") -> "ÃŽ",
    ("^", "o") -> "Ã´",
    ("^", "O") -> "Ã”",
    ("^", "u") -> "Ã»",
    ("^", "U") -> "Ã›",
    ("^", "y") -> "Å·",
    ("^", "Y") -> "Å¶",
    ("\"", "a") -> "Ã¤",
    ("\"", "A") -> "Ã„",
    ("\"", "e") -> "Ã«",
    ("\"", "E") -> "Ã‹",
    ("\"", "i") -> "Ã¯",
    ("\"", "I") -> "Ã",
    ("\"", "o") -> "Ã¶",
    ("\"", "O") -> "Ã–",
    ("\"", "u") -> "Ã¼",
    ("\"", "U") -> "Ãœ",
    ("\"", "y") -> "Ã¿",
    ("\"", "Y") -> "Å¸",
    ("~", "a") -> "Ã£",
    ("~", "A") -> "Ãƒ",
    ("~", "n") -> "Ã±",
    ("~", "N") -> "Ã‘",
    ("u", "a") -> "Äƒ",
    ("u", "A") -> "Ä‚",
    ("u", "e") -> "Ä•",
    ("u", "E") -> "Ä”",
    ("u", "g") -> "ÄŸ",
    ("u", "G") -> "Äž",
    ("u", "i") -> "Ä­",
    ("u", "I") -> "Ä¬",
    ("u", "o") -> "Å",
    ("u", "O") -> "ÅŽ",
    ("u", "u") -> "Å­",  
    ("u", "U") -> "Å¬",
    ("v", "a") -> "ÇŽ",
    ("v", "A") -> "Ç",
    ("v", "c") -> "Ä",
    ("v", "C") -> "ÄŒ",
    ("v", "e") -> "Ä›",
    ("v", "E") -> "Äš",
    ("v", "i") -> "Ç",
    ("v", "I") -> "Ç",
    ("v", "o") -> "Ç’",
    ("v", "O") -> "Ç‘",
    ("v", "s") -> "Å¡",
    ("v", "S") -> "Å ",
    ("v", "u") -> "Ç”",
    ("v", "U") -> "Ç“",
    ("v", "z") -> "Å¾",
    ("v", "Z") -> "Å½"
  )

  private val binary : Map[(String,String,String),String] = Map(
    ("frac", "1", "2") -> "Â¼",
    ("frac", "1", "4") -> "Â½",
    ("frac", "3", "4") -> "Â¾",
    ("frac", "1", "3") -> "â…“",
    ("frac", "1", "5") -> "â…•",
    ("frac", "1", "6") -> "â…™",
    ("frac", "1", "7") -> "â…",
    ("frac", "1", "8") -> "â…›",
    ("frac", "1", "9") -> "â…‘",
    ("frac", "1", "10") -> "â…’",
    ("frac", "2", "3") -> "â…”",
    ("frac", "2", "5") -> "â…–",
    ("frac", "3", "5") -> "â…—",
    ("frac", "3", "8") -> "â…œ",
    ("frac", "4", "5") -> "â…˜",
    ("frac", "5", "6") -> "â…š",
    ("frac", "5", "8") -> "â…",
    ("frac", "7", "8") -> "â…ž"
  )

  private val defs : Map[(String,Int),Seq[Group]=>Option[String]] = Map(
    ("mathbb", 1) -> ((s : Seq[Group]) => intoFont(s, mathbb)),
    ("mathcal", 1) -> ((s : Seq[Group]) => intoFont(s, mathcal))
  )

  private def intoFont(ss : Seq[Group], font : Array[String]) : Option[String] = ss match {
    case Seq(Group(Seq(RawString(str)))) => Some(str.flatMap(intoFont(_, font)))
    case _ => None
  }

  private def intoFont(c : Char, font : Array[String]) : String = {
    if(c >= '0' && c <= '9') {
      font(c - '0')
    } else if(c >= 'A' && c <= 'Z') {
      font((c - 'A') + 10)
    } else if(c >= 'a' && c <= 'z') {
      font((c - 'a') + 36)
    } else {
      c.toString
    }
  }

  private val mathbb : Array[String] = Array("ðŸ˜", "ðŸ™", "ðŸš", "ðŸ›", "ðŸœ", "ðŸ", "ðŸž", "ðŸŸ", "ðŸ ", "ðŸ¡", "ð”¸", "ð”¹", "â„‚", "ð”»", "ð”¼", "ð”½", "ð”¾", "â„", "ð•€", "ð•", "ð•‚", "ð•ƒ", "ð•„", "â„•", "ð•†", "â„™", "â„š", "â„", "ð•Š", "ð•‹", "ð•Œ", "ð•", "ð•Ž", "ð•", "ð•", "â„¤", "ð•’", "ð•“", "ð•”", "ð••", "ð•–", "ð•—", "ð•˜", "ð•™", "ð•š", "ð•›", "ð•œ", "ð•", "ð•ž", "ð•Ÿ", "ð• ", "ð•¡", "ð•¢", "ð•£", "ð•¤", "ð•¥", "ð•¦", "ð•§", "ð•¨", "ð•©", "ð•ª", "ð•«")

  private val mathcal : Array[String] = Array("0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "ð“", "ð“‘", "ð“’", "ð““", "ð“”", "ð“•", "ð“–", "ð“—", "ð“˜", "ð“™", "ð“š", "ð“›", "ð“œ", "ð“", "ð“ž", "ð“Ÿ", "ð“ ", "ð“¡", "ð“¢", "ð“£", "ð“¤", "ð“¥", "ð“¦", "ð“§", "ð“¨", "ð“©", "ð“ª", "ð“«", "ð“¬", "ð“­", "ð“®", "ð“¯", "ð“°", "ð“±", "ð“²", "ð“³", "ð“´", "ð“µ", "ð“¶", "ð“·", "ð“¸", "ð“¹", "ð“º", "ð“»", "ð“¼", "ð“½", "ð“¾", "ð“¿", "ð”€", "ð”", "ð”‚", "ð”ƒ")
}
